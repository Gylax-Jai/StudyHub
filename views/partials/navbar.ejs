<header class="bg-white shadow-md sticky top-0 z-50">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center py-4">
      <div class="flex items-center">
        <div class="flex-shrink-0">
          <a href="/" class="flex items-center space-x-2">
            <span class="bg-blue-600 text-white p-2 rounded-lg">
              <i class="fas fa-graduation-cap"></i>
            </span>
            <span class="text-2xl font-bold gradient-text">StudyHub</span>
          </a>
        </div>
      </div>

      <!-- Desktop Navigation -->
      <nav class="hidden md:flex items-center space-x-8">
        <a href="/#home" class="nav-link text-gray-700 hover:text-blue-600 font-medium">Home</a>
        <a href="/#features" class="nav-link text-gray-700 hover:text-blue-600 font-medium">Features</a>
        <a href="/#materials" class="nav-link text-gray-700 hover:text-blue-600 font-medium">Materials</a>
        <a href="/#testimonials" class="nav-link text-gray-700 hover:text-blue-600 font-medium">Testimonials</a>
        <a href="/#contact" class="nav-link text-gray-700 hover:text-blue-600 font-medium">Contact</a>

        <% if (!currentUser) { %>
          <a href="/login"
            class="bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 transition-all flex items-center space-x-2">
            <span>Login</span>
            <i class="fas fa-sign-in-alt"></i>
          </a>
          <% } else { %>
            <div class="relative group" id="user-menu-wrapper">
              <button id="user-menu-button"
                class="bg-gray-100 text-gray-800 px-4 py-2 rounded-lg flex items-center space-x-2 hover:bg-gray-200 focus:outline-none">
                <i class="fas fa-user-circle"></i>
                <span>
                  <%= currentUser.username %>
                </span>
                <i class="fas fa-chevron-down text-xs"></i>
              </button>

              <div id="user-menu-dropdown"
                class="absolute right-0 top-12 w-40 bg-white shadow-lg rounded-lg hidden group-hover:block z-50">
                <a href="/profile" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Profile</a>
                <a href="/logout" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">Logout</a>
              </div>
            </div>

            <% } %>
      </nav>

      <!-- Mobile menu button -->
      <div class="md:hidden flex items-center">
        <button id="mobile-menu-button" class="text-gray-700 hover:text-blue-600 focus:outline-none">
          <i class="fas fa-bars text-2xl"></i>
        </button>
      </div>
    </div>

    <!-- Mobile Navigation -->
    <div id="mobile-menu" class="hidden md:hidden py-4 border-t">
      <div class="flex flex-col space-y-4">
        <a href="/#home" class="text-gray-700 hover:bg-blue-50 hover:text-blue-600 px-4 py-2 rounded-lg">Home</a>
        <a href="/#features"
          class="text-gray-700 hover:bg-blue-50 hover:text-blue-600 px-4 py-2 rounded-lg">Features</a>
        <a href="/#materials"
          class="text-gray-700 hover:bg-blue-50 hover:text-blue-600 px-4 py-2 rounded-lg">Materials</a>
        <a href="/#testimonials"
          class="text-gray-700 hover:bg-blue-50 hover:text-blue-600 px-4 py-2 rounded-lg">Testimonials</a>
        <a href="/#contact" class="text-gray-700 hover:bg-blue-50 hover:text-blue-600 px-4 py-2 rounded-lg">Contact</a>

        <% if (!currentUser) { %>
          <a href="/login"
            class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center space-x-2 justify-center">
            <span>Login</span>
            <i class="fas fa-sign-in-alt"></i>
          </a>
          <% } else { %>
            <a href="/profile" class="text-gray-700 hover:bg-blue-50 px-4 py-2 rounded-lg text-center">Profile</a>
            <a href="/logout" class="text-gray-700 hover:bg-blue-50 px-4 py-2 rounded-lg text-center">Logout</a>
            <% } %>
      </div>
    </div>
  </div>
</header>

<script>
  const button = document.getElementById('user-menu-button');
  const dropdown = document.getElementById('user-menu-dropdown');
  const wrapper = document.getElementById('user-menu-wrapper');

  let isDropdownVisible = false;

  button.addEventListener('click', function (e) {
    e.stopPropagation();
    isDropdownVisible = !isDropdownVisible;
    dropdown.classList.toggle('hidden', !isDropdownVisible);
  });

  // Hide dropdown when clicking outside
  window.addEventListener('click', function () {
    if (isDropdownVisible) {
      dropdown.classList.add('hidden');
      isDropdownVisible = false;
    }
  });

  // Prevent hiding when hovering (hover will be handled by CSS)
  wrapper.addEventListener('mouseenter', () => {
    dropdown.classList.remove('hidden');
  });

  wrapper.addEventListener('mouseleave', () => {
    if (!isDropdownVisible) {
      dropdown.classList.add('hidden');
    }
  });
</script>
